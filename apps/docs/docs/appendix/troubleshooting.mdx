---
id: troubleshooting
title: Troubleshooting
description: Guidance for resolving common operational issues with Open Mercato.
---

## Database Connection Pooling

Open Mercato relies on PostgreSQL connection pooling to avoid "too many clients" errors. Tune the pool via environment variables to match your deployment footprint.

### Pool Configuration

- `DB_POOL_MIN` — Minimum connections in the pool (default: `2`)
- `DB_POOL_MAX` — Maximum connections in the pool (default: `20`)
- `DB_POOL_IDLE_TIMEOUT` — Idle timeout in milliseconds before a connection is released (default: `30000`)
- `DB_POOL_ACQUIRE_TIMEOUT` — Acquire timeout in milliseconds when waiting for a connection (default: `60000`)

### Recommended Settings

Production baseline:

```bash
# Adjust according to PostgreSQL max_connections
DB_POOL_MAX=20
DB_POOL_MIN=5
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_ACQUIRE_TIMEOUT=60000
```

Local development:

```bash
# Smaller pool for local workflows
DB_POOL_MAX=5
DB_POOL_MIN=1
DB_POOL_IDLE_TIMEOUT=10000
DB_POOL_ACQUIRE_TIMEOUT=30000
```

If you continue to hit connection limits, verify that background workers and migrations use the same pool settings, and confirm that your database `max_connections` value comfortably exceeds the aggregate pool size across all applications connecting to it.

## PostgreSQL auth errors on local setup

If local commands such as `yarn generate`, `yarn db:generate`, or app startup fail with errors like:

- `password authentication failed for user "postgres"`
- `role "postgres" does not exist`
- `could not connect to server`

you may be connecting to a different PostgreSQL instance already bound to `localhost:5432` (for example, a host-installed Postgres), not the Docker one started for Open Mercato.

### Fix

Start Docker PostgreSQL on a different host port and use the same port in `DATABASE_URL`:

```bash
POSTGRES_PORT=55432 docker compose up -d postgres
```

```env
DATABASE_URL=postgresql://postgres:postgres@localhost:55432/open-mercato
```

### Verify

```bash
psql "postgresql://postgres:postgres@localhost:55432/open-mercato" -c "select 1;"
```

If this succeeds but `:5432` still fails, keep using the alternate port (or stop the other local PostgreSQL service that occupies `5432`).

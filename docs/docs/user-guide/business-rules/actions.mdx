---
title: Action Builder
description: Configure actions that execute when business rule conditions pass or fail.
---

# Action Builder

Actions define what happens when rule conditions are evaluated. Rules have two sets of actions:
- **Success Actions** - Execute when conditions are true
- **Failure Actions** - Execute when conditions are false

## Action Types

Open Mercato supports 10 action types covering user feedback, state control, field updates, notifications, and integrations.

### ALLOW_TRANSITION

**Purpose**: Explicitly allow a state transition

**Use case**: GUARD rules that permit operations when conditions are met

**Configuration**: No configuration required

**Example**: Allow work order release when materials are available

### BLOCK_TRANSITION

**Purpose**: Block a state transition and display an error message

**Use case**: GUARD rules that prevent operations when conditions fail

**Configuration**:
- `message` (required) - Error message shown to user

**Example**:
```
Message: "Cannot release work order. Required materials are not available."
```

> ðŸ’¡ GUARD rules typically use BLOCK_TRANSITION as a failure action

### LOG

**Purpose**: Write a message to execution logs

**Use case**: Audit trail, debugging, analytics

**Configuration**:
- `level` (required) - Log level: `info`, `warn`, `error`, `debug`
- `message` (required) - Log message

**Example**:
```
Level: info
Message: "Order {{orderId}} approved by {{user.email}}"
```

### SHOW_ERROR

**Purpose**: Display an error message to the user

**Use case**: Validation failures, business rule violations

**Configuration**:
- `message` (required) - Error message text

**Example**:
```
Message: "Order total exceeds customer credit limit. Please contact finance."
```

### SHOW_WARNING

**Purpose**: Display a warning message to the user

**Use case**: Non-blocking alerts, recommendations

**Configuration**:
- `message` (required) - Warning message text

**Example**:
```
Message: "This order is below minimum quantity for free shipping."
```

### SHOW_INFO

**Purpose**: Display an informational message to the user

**Use case**: Confirmations, status updates, tips

**Configuration**:
- `message` (required) - Info message text

**Example**:
```
Message: "Order has been submitted for approval. You will be notified when approved."
```

### NOTIFY

**Purpose**: Send notifications to specified recipients

**Use case**: Alert users about events, approvals, escalations

**Configuration**:
- `recipients` (required) - Comma-separated list of user emails or IDs
- `message` (required) - Notification message

**Example**:
```
Recipients: manager@company.com, supervisor@company.com
Message: "Work order {{workOrderId}} requires approval. Priority: {{priority}}"
```

### SET_FIELD

**Purpose**: Set an entity field to a specific value

**Use case**: Auto-populate fields, calculated values, status updates

**Configuration**:
- `field` (required) - Field path to set (dot notation supported)
- `value` (required) - Value to set (supports interpolation)

**Example**:
```
Field: approvalRequired
Value: true
```

**With interpolation**:
```
Field: assignedTo
Value: {{user.id}}
```

### CALL_WEBHOOK

**Purpose**: Make an HTTP POST request to an external URL

**Use case**: Integrate with external systems, trigger third-party workflows

**Configuration**:
- `url` (required) - HTTP/HTTPS endpoint
- `method` (required) - HTTP method: `GET`, `POST`, `PUT`, `DELETE`
- `payload` (optional) - JSON payload to send

**Example**:
```
URL: https://api.example.com/webhooks/order-created
Method: POST
Payload: {"orderId": "{{orderId}}", "total": {{total}}}
```

> âš ï¸ Webhooks execute asynchronously. Failures don't block the rule.

### EMIT_EVENT

**Purpose**: Emit a domain event to the event bus

**Use case**: Trigger other system behaviors, event-driven architectures

**Configuration**:
- `eventName` (required) - Name of the event to emit
- `payload` (optional) - Event payload data

**Example**:
```
Event Name: order.approved
Payload: {"orderId": "{{orderId}}", "approvedBy": "{{user.id}}"}
```

## Message Interpolation

All message fields support interpolation using `{{field}}` syntax. Field values are inserted at runtime.

**Basic Interpolation**:
```
"Order {{orderId}} has been assigned to {{assignedTo}}"
```

**Nested Fields**:
```
"Customer {{customer.name}} from {{customer.address.city}} placed an order"
```

**Special Values**:
```
"Approved by {{user.email}} on {{today}}"
```

**Multiple Values**:
```
"Order {{orderId}} total {{total}} exceeds threshold {{threshold}}"
```

## Success vs. Failure Actions

### Success Actions

Execute when rule conditions evaluate to **true**.

**Use cases**:
- Log successful operations
- Send confirmation notifications
- Set calculated field values
- Trigger downstream processes

**Example** (Approval workflow):
```
Conditions: orderTotal > 10000
Success Actions:
  - SET_FIELD: approvalRequired = true
  - NOTIFY: approver@company.com, "Order requires approval"
  - SHOW_INFO: "Order submitted for approval"
```

### Failure Actions

Execute when rule conditions evaluate to **false**.

**Use cases**:
- Block invalid operations (GUARD rules)
- Display validation errors
- Log rejection reasons
- Notify about failures

**Example** (Material availability guard):
```
Conditions: materialsAvailable = true
Failure Actions:  (execute when materials NOT available)
  - BLOCK_TRANSITION
  - SHOW_ERROR: "Materials not available"
  - NOTIFY: materialPlanner@company.com, "Material shortage for WO {{woId}}"
```

> ðŸ’¡ **GUARD Rules**: Use failure actions to block operations. Success actions allow the operation to proceed.

## Action Sequencing

When multiple actions are defined, they execute in the order listed (top to bottom).

**Reordering**: Use up/down arrow buttons to change execution order.

**Why Order Matters**:
- Blocking actions stop further execution
- Field values set early can be used in later actions
- Logs should typically come before external calls

**Example**:
```
1. LOG: "Processing order validation"
2. SET_FIELD: validatedAt = {{now}}
3. SHOW_INFO: "Order validated successfully"
4. NOTIFY: "Order ready for processing"
5. EMIT_EVENT: order.validated
```

## Building Actions in the UI

### Adding Actions

1. Navigate to the **Success Actions** or **Failure Actions** section
2. Click **Add Action**
3. Select the **Action Type** from the dropdown
4. Fill in configuration fields (message, recipients, etc.)
5. Click outside or press Enter to save

### Configuring Actions

Each action type has specific configuration fields:

**Text Fields**: Enter values directly or use interpolation
**Dropdowns**: Select from predefined options (log level, HTTP method)
**Multiline**: For longer messages or JSON payloads

### Reordering Actions

Click the up/down arrow icons to move actions:
- Up arrow: Move action higher in the list (executes earlier)
- Down arrow: Move action lower in the list (executes later)

### Deleting Actions

Click the trash icon to remove an action.

### JSON Preview

Click **Show JSON** to view the raw JSON structure. Useful for:
- Debugging action configuration
- Copying actions between rules
- Understanding the data model

## Validation

The system validates actions as you configure them:

**Required Fields**: Marked with red asterisk, must be filled
**Field Paths**: Validated for SET_FIELD actions
**URLs**: Must be valid HTTP/HTTPS for CALL_WEBHOOK
**JSON Syntax**: Checked for payload fields
**Interpolation**: Validated for proper {{field}} syntax

## Common Patterns

### Approval Workflow

```
Success Actions (when approval needed):
  - SET_FIELD: status = "PENDING_APPROVAL"
  - SET_FIELD: approvalRequestedAt = {{now}}
  - NOTIFY: approver@company.com, "Approval needed for {{entityType}} {{entityId}}"
  - SHOW_INFO: "Submitted for approval"
```

### Guard with Feedback

```
Failure Actions (when guard blocks operation):
  - BLOCK_TRANSITION
  - SHOW_ERROR: "Operation not allowed: {{reason}}"
  - LOG: error, "Blocked {{operation}} for {{entityId}}: {{reason}}"
  - NOTIFY: admin@company.com, "Blocked operation detected"
```

### Audit Trail

```
Success Actions:
  - LOG: info, "{{operation}} performed by {{user.email}} on {{entityType}} {{entityId}}"
  - SET_FIELD: lastModifiedBy = {{user.id}}
  - SET_FIELD: lastModifiedAt = {{now}}
```

### External Integration

```
Success Actions:
  - LOG: info, "Triggering external sync for {{entityId}}"
  - CALL_WEBHOOK: POST https://api.external.com/sync
  - EMIT_EVENT: entity.synced
```

## Tips and Best Practices

**Start Simple**: Begin with one or two actions, add more as needed

**Use Descriptive Messages**: Write clear, actionable messages that help users understand what happened

**Log Important Events**: Use LOG actions for audit trail and debugging

**Order Matters**: Place blocking actions early, external calls late

**Test Interpolation**: Verify that field values interpolate correctly

**Handle Errors**: Consider what happens if an action fails (webhooks, events)

**Avoid Side Effects in Dry Run**: Some actions (webhooks, events) execute even in dry run mode

**Use Notifications Wisely**: Don't spam users with too many notifications

## Troubleshooting

**Action Not Executing**:
- Check that the action is in the correct section (success vs. failure)
- Verify conditions are evaluating as expected
- Review execution logs for errors

**Interpolation Not Working**:
- Check field path syntax (use dot notation)
- Verify field exists on the entity
- Review execution logs for "undefined" values

**Webhook Failures**:
- Check URL is accessible
- Verify authentication if required
- Review webhook endpoint logs
- Check payload JSON syntax

**Field Not Setting**:
- Verify field path is correct
- Check field is writable (not computed or read-only)
- Ensure value type matches field type

## Next Steps

- [**Execution Logs**](./execution-logs) - Monitor action execution
- [**API Reference**](../../api/business-rules/execute) - Execute rules programmatically

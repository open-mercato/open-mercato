---
title: Model konceptualny
sidebar_position: 40
---

Ten dokument opisuje model pojęciowy (nie techniczny) dla MVP.

## Encje (MVP)

1. `incoming_shipment` – Przesyłka wpływająca
2. `jrwa_class` – JRWA (klasa/pozycja)
3. `case_register` – Spis spraw
4. `case` – Sprawa
5. `folder` – Koszulka
6. `document` – Dokument
7. `chronological_location` – Skład chronologiczny: lokalizacja
8. `record_link` – Powiązanie (neutralne)

Nazwy techniczne są robocze; finalnie będą zależeć od nazwy modułu i istniejących konwencji.

## Relacje (przez ID)

- `document.incomingShipmentId` (opcjonalne)
- `document.folderId` (opcjonalne)
- `document.caseId` (opcjonalne)
  - Zasada: dokument może być przypięty do **dokładnie jednego** obiektu: `folderId` XOR `caseId`.
- `document.attachmentIds` (tablica, opcjonalne)
  - Referencje do załączników z modułu `attachments` (core)
  - Dokument jest konceptualnie załącznikiem z metadanymi – wykorzystuje `attachments` do przechowywania plików

- `case.jrwaClassId` (wymagane)
- `case.caseRegisterId` (wymagane)

- `record_link.aType` + `record_link.aId`
- `record_link.bType` + `record_link.bId`
  - typ: `case` | `folder`
  - powiązanie jest **symetryczne** (a↔b) i **neutralne** (bez etykiety)

## Zasady spójności (MVP)

- Dokument może istnieć bez przesyłki.
- Dokument może być przypięty do sprawy lub koszulki niezależnie od przesyłki.
- Przesyłka nie inicjuje sprawy automatycznie.

### Read-only (zamknięcie)

Sprawa i koszulka mogą zostać wprowadzone w stan **read-only** (zamknięte).

- Read-only blokuje: edycję pól, dopinanie/odpinanie dokumentów, dodawanie/usuwanie powiązań.
- Read-only jest odwracalne (reopen), ale wymaga uprawnienia (RBAC) — do ustalenia w module `records`.

### Powiązania (neutralne, symetryczne)

- Dopuszczamy: sprawa↔sprawa, koszulka↔koszulka, sprawa↔koszulka.
- Rekomendacja spójności: powiązanie przechowujemy jako jedną parę (A,B) z kanonicznym uporządkowaniem (żeby uniknąć duplikatów A–B i B–A).

## Skład chronologiczny: lokalizacja i historia

Wymaganie: lokalizacja ma historię zmian.

Rekomendowany model konceptualny:

- `chronological_location` opisuje miejsce (np. regał/półka/pojemnik).
- `chronological_location_assignment` (lub równoważny mechanizm) przechowuje historię przypisań dokumentów do lokalizacji:
  - `documentId`
  - `locationId`
  - `validFrom`
  - `validTo` (nullable)
  - `note` (opcjonalne)

To rozdzielenie pozwala:

- mieć słownik lokalizacji,
- utrzymywać historię bez nadpisywania.

## Oznaczenia przesyłki (zamiast statusów)

Minimalny zestaw pól oznaczeń:

- `hasChronologicalRegistration: boolean`
- `mappingCoverage: 'none' | 'partial' | 'full'`

Szczegóły doprecyzowujemy w słowniku danych.

## Dokument jako załącznik z metadanymi

**Dokument** w systemie EZD jest nośnikiem treści – w praktyce jest to plik (lub zbiór plików) z dodatkowymi metadanymi kancelaryjno-archiwalnymi.

### Model konceptualny

W OpenMercato:

- **Encja `records.documents`** przechowuje metadane dokumentu:
  - identyfikacja: tytuł, rodzaj, znak
  - daty: data dokumentu, data wpływu
  - klasyfikacja: poziom dostępu
  - powiązania: przesyłka, sprawa lub koszulka
- **Moduł `attachments` (core)** zarządza fizycznymi plikami:
  - upload/download
  - przechowywanie
  - metadane pliku (nazwa, rozmiar, typ MIME)

### Relacja dokument–załączniki

- Dokument może mieć jeden lub więcej załączników (plików).
- Relacja jest realizowana przez pole `attachmentIds` (lub podobne) w encji `records.documents`.
- Główny właściciel załączników jest określany przez kontekst dokumentu:
  - Dokument powiązany z przesyłką → właściciel: przesyłka
  - Dokument powiązany ze sprawą → właściciel: sprawa
  - Dokument powiązany z koszulką → właściciel: koszulka
  - Dokument samodzielny → właściciel: dokument

### Implikacje dla RBAC

Dostęp do załączników jest kontrolowany poprzez:

1. Uprawnienia do głównego właściciela (przesyłka/sprawa/koszulka/dokument)
2. Poziom dostępu dokumentu (`accessLevel`)
3. Status właściciela (np. `read-only` dla sprawy/koszulki)

Użytkownik ma dostęp do załączników dokumentu, jeśli:

- Ma uprawnienia do odczytu głównego właściciela
- Poziom dostępu dokumentu pozwala na odczyt
- Główny właściciel nie jest w stanie blokującym dostęp

### Cykl życia

- **Tworzenie**: Upload plików przez moduł `attachments`, referencje zapisywane w `records.documents`
- **Aktualizacja**: Możliwość dodawania/usuwania załączników (jeśli właściciel nie jest `read-only`)
- **Usuwanie**: Polityka usuwania załączników do zdefiniowania (cascade delete lub orphan handling)

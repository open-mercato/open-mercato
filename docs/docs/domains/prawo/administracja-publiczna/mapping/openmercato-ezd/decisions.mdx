---
title: Decyzje (EZD → OpenMercato)
sidebar_position: 90
---

Ten dokument zbiera decyzje projektowe związane z mapowaniem kancelaryjno‑archiwalnym na OpenMercato.

Format decyzji (ADR‑like):

- Id: `D-XXX`
- Kontekst
- Decyzja
- Konsekwencje
- Status: proposed/accepted/superseded

## D-001: MVP ograniczone do CRUD

- Status: accepted
- Kontekst: chcemy szybko zmapować model danych i API.
- Decyzja: na start budujemy tylko CRUD + walidacje + OpenAPI.
- Konsekwencje: procesy/workflow będą opisywane, ale wdrażane później.

## D-002: RPW jako numeracja/widok

- Status: accepted
- Kontekst: RPW jest rejestrem przesyłek wpływających.
- Decyzja: RPW nie jest osobną encją – to numeracja + widoki na przesyłkach.
- Konsekwencje: pola RPW lądują na encji przesyłki; raporty/listy budujemy query.

## D-003: Koszulka → Sprawa 1:1

- Status: superseded (by D-009)
- Kontekst: pierwotnie zakładaliśmy „koszulkę” jako obiekt przejściowy przed sprawą.
- Decyzja: (nieaktualne) koszulka jest encją i może zostać przekształcona w sprawę 1:1.
- Konsekwencje: (nieaktualne) pola wiążące typu `folder.caseId` / `case.folderId`.

## D-009: Ujednolicenie Sprawa = Koszulka

- Status: accepted
- Kontekst:
- Analiza wymagań wykazała, że "Koszulka" i "Sprawa" są konceptualnie tym samym obiektem.
- "Sprawa" to "Koszulka" z przypisanym znakiem sprawy.
- Utrzymywanie dwóch osobnych encji prowadziło do nadmiernej złożoności i niespójności w dokumentacji.
- Decyzja:
- Sprawa i Koszulka są tą samą encją (`records.cases`).
- Pole `sign` (znak sprawy) jest opcjonalne:
- Gdy `sign` jest wypełniony → rekord funkcjonuje jako pełna "Sprawa"
- Gdy `sign` jest pusty → rekord funkcjonuje jako "Koszulka" (kontener roboczy/teczka tematyczna)
- Usuwamy osobną encję `records.folders`.
- Konsekwencje:
- Uproszczenie modelu danych (7 encji zamiast 8).
- Dokumenty powiązane są tylko z `caseId` (nie `folderId`).
- Powiązania między rekordami (`record_links`) używają tylko typu `case`.
- Wszystkie referencje do "Koszulki" w dokumentacji są aktualizowane, aby odzwierciedlać ten ujednolicony model.
- CRUD dla sprawy obsługuje zarówno rekordy z przypisanym znakiem sprawy, jak i bez niego.

## D-007: Powiązania neutralne + read-only (Sprawa)

- Status: accepted (aktualizowane przez D-009)
- Kontekst:
	- W źródłach pojawia się potrzeba „wzajemnie powiązanych spraw”.
	- Sprawy i koszulki służą katalogowaniu informacji i wymagają elastycznego łączenia.
	- Potrzebujemy możliwości „zamknięcia” obiektu (blokady zmian) oraz późniejszego otwarcia.
- Decyzja:
	- Sprawy i koszulki są osobnymi obiektami domenowymi i encjami (MVP).
	- Powiązania między obiektami są **neutralne** (bez typu/etykiety) i **symetryczne**.
		- Dopuszczamy: sprawa↔sprawa, koszulka↔koszulka, sprawa↔koszulka.
	- Wprowadzamy stan **read-only** (zamknięcie) dla spraw i koszulek.
		- Read-only blokuje: edycję pól, dopinanie/odpinanie dokumentów, dodawanie/usuwanie powiązań.
		- Read-only jest **odwracalne** (reopen), ale wymaga dedykowanego uprawnienia (RBAC) — nazwa do ustalenia w module `records`.
	- Dokument może być przypięty do **dokładnie jednego** obiektu: sprawy *albo* koszulki (lub do żadnego).
- Konsekwencje:
	- Usuwamy koncepcję „koszulka → sprawa 1:1” i wynikające z niej pola/endpointy.
	- Dodajemy encję/zasób powiązań (roboczo: `records.record_links`) oraz reguły unikalności par.
	- W CRUD dla spraw/koszulek musimy walidować blokady read-only.

## D-004: Dokument może istnieć bez przesyłki

- Status: accepted
- Kontekst: dokument może zostać „przyniesiony”.
- Decyzja: `document.incomingShipmentId` jest opcjonalne.
- Konsekwencje: walidacje nie mogą wymagać przesyłki.

## D-005: Skład chronologiczny – lokalizacja jako encja z historią

- Status: accepted
- Kontekst: lokalizacja ma być śledzona w czasie.
- Decyzja: modelujemy lokalizacje oraz historię przypisań (bez nadpisywania).
- Konsekwencje: potrzebny jest dodatkowy zasób „history/assignments”.

## D-006: Wyszukiwanie MVP = tokens dla Spraw i Dokumentów

- Status: accepted
- Kontekst: chcemy, aby użytkownik mógł szybko znajdować rekordy Cmd+K, ale bez wdrażania fulltext/vector w MVP.
- Decyzja:
	- W MVP indeksujemy i wystawiamy w Cmd+K tylko: **Sprawa** (obejmuje rekordy z i bez znaku sprawy) i **Dokument**.
	- Strategia search na start: **tokens**.
- Konsekwencje:
	- CRUD dla tych encji musi odświeżać `query_index`.
	- Moduł `records` musi dostarczyć presenter (`formatResult`) dla tokens, żeby wyniki były czytelne.

## D-008: Dokument jako załącznik z metadanymi

- Status: accepted
- Kontekst:
	- Dokumenty w systemie EZD są nośnikami treści, które mogą mieć różne formy (elektroniczne pliki, skany papierowych dokumentów).
	- Potrzebujemy spójnego podejścia do przechowywania i zarządzania plikami w systemie.
	- OpenMercato posiada moduł `attachments` (core) do zarządzania plikami.
- Decyzja:
	- **Dokument** (encja `records.documents`) jest konceptualnie **załącznikiem z metadanymi**.
	- Dokument wykorzystuje moduł `attachments` do przechowywania plików.
	- Relacja: każdy rekord dokumentu może mieć powiązane załączniki (pliki) poprzez `attachmentId` lub wielokrotne załączniki.
	- Metadane dokumentu (tytuł, rodzaj, poziom dostępu, daty, powiązania) są przechowywane w encji `records.documents`.
	- Fizyczne pliki są zarządzane przez moduł `attachments`.
- Konsekwencje:
	- Encja `records.documents` zawiera pola metadanych oraz referencje do załączników (`attachmentIds` lub podobne).
	- RBAC dla dokumentów musi uwzględniać zasady dostępu do załączników.
	- Główny właściciel załącznika (primary owner) jest określany przez powiązanie dokumentu:
		- Jeśli dokument ma `incomingShipmentId` → właścicielem jest przesyłka.
		- Jeśli dokument ma `caseId` → właścicielem jest sprawa (niezależnie od tego, czy ma przypisany znak sprawy).
		- Jeśli dokument nie ma żadnego powiązania → właścicielem jest sam dokument.
	- API dokumentów musi obsługiwać upload/download plików przez moduł `attachments`.
	- Przy usuwaniu dokumentu należy rozważyć politykę usuwania powiązanych załączników (cascade delete lub orphan handling).

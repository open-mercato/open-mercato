---
title: Mapowanie API (CRUD)
sidebar_position: 60
---

Ten dokument opisuje minimalny zestaw endpointów CRUD dla MVP.

## Zasady

- Każda encja MVP ma standardowe operacje: list/get/create/update/delete.
- Dla list: paginacja, podstawowe filtrowanie, sortowanie.
- Brak procesów asynchronicznych w MVP.

## Proponowane zasoby

| Zasób | Endpoint (docelowy) | Uwagi |
|---|---|---|
| Przesyłki wpływające | `/api/records/incoming-shipments` | RPW jako numeracja na rekordzie |
| Dokumenty | `/api/records/documents` | dokument może istnieć sam |
| Koszulki | `/api/records/folders` | koszulka → sprawa 1:1 (patrz niżej) |
| Sprawy | `/api/records/cases` | nie inicjujemy automatycznie z przesyłki |
| Powiązania | `/api/records/record-links` | neutralne, symetryczne linki spraw/koszulek |
| Spisy spraw | `/api/records/case-registers` | numeracja spraw do dopięcia |
| JRWA | `/api/records/jrwa-classes` | drzewo klas |
| Lokalizacje składu | `/api/records/chronological-locations` | słownik |
| Historia lokalizacji | `/api/records/chronological-assignments` | historia przypisań dokument↔lokalizacja |

## Operacje „na granicy CRUD"

### Read-only (zamknięcie / otwarcie)

Sprawa i koszulka mogą zostać ustawione jako **read-only** (zamknięte). Read-only:

- blokuje edycję pól,
- blokuje dopinanie/odpinanie dokumentów,
- blokuje dodawanie/usuwanie powiązań.

Read-only jest odwracalne (reopen), ale wymaga dedykowanego uprawnienia (RBAC) — do ustalenia w module `records`.

W MVP traktujemy to jako standardowy `PATCH/PUT` na encji (`isReadOnly: true/false`).

### Powiązania (neutralne, symetryczne)

Powiązania są neutralne (bez typu/etykiety) i symetryczne.

W MVP:

- tworzenie: `POST /api/records/record-links`
- usuwanie: `DELETE /api/records/record-links/{id}`
- listowanie: `GET /api/records/record-links?type=case|folder&id=<uuid>`

Walidacje:

- brak duplikatów A–B i B–A,
- A != B,
- jeśli dowolna strona jest read-only → brak zmian w powiązaniach.

## Przesyłka: oznaczenia odwzorowania

Zamiast statusów przesyłka posiada pola/flagę odwzorowania:

- rejestracja w składzie chronologicznym
- odwzorowanie pełne / częściowe

Te pola są aktualizowane przez standardowe `PATCH/PUT` na przesyłce.

## Search/indexer requirements (MVP)

W MVP wyszukiwanie Cmd+K ma obejmować tylko:

- **Sprawy**
- **Dokumenty**

Strategia search: **tokens**.

### Wymagania dla indeksowania (`query_index`)

CRUD dla `records.cases` i `records.documents` musi odświeżać indeks.

Checklist (implementacyjnie):

- Każdy CRUD route ma ustawiony `indexer: { entityType }`.
- `entityType` jest stabilnym identyfikatorem typu rekordu (np. `records:case`, `records:document` – do potwierdzenia konwencji).
- Po create/update/delete emitujemy side effects tak, aby rekord był widoczny w `tokens` search.

### Wymagania dla prezentacji wyników (`search.ts`)

Ponieważ `tokens` search renderuje wynik na podstawie konfiguracji w module search, moduł `records` musi dostarczyć presenter.

Checklist:

- Plik `search.ts` w module `records` zawiera wpisy dla `records:case` oraz `records:document`.
- Każdy wpis ma `formatResult` (title/subtitle/icon), aby uniknąć wyników w stylu „UUID”.
- (Opcjonalnie) `resolveUrl` kieruje do docelowej strony backend (gdy powstanie UI).
